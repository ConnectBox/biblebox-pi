<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Per-build</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part25.htm">&lt; Previous</a><span> | </span><a href="../Making%20A%20ConnectBox%20on%20RPi.html">Contents</a></p><p class="s34" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Per-build</p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">deployment</p><p style="text-indent: 0pt;text-align: left;"/><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">/vagrant</p><p style="text-indent: 0pt;text-align: left;"/><p class="s24" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This assumes you&#39;re using the automated machine setup above. If you&#39;re using the</p><p class="s24" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">manual method, you can probably replace</p><p class="s24" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">with the</p><p class="s24" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">directory</p><p class="s24" style="padding-left: 219pt;text-indent: 0pt;line-height: 111%;text-align: center;">of the 1.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s24" style="padding-left: 219pt;text-indent: 0pt;text-align: center;">2.</p><p class="s24" style="padding-left: 120pt;text-indent: 0pt;text-align: left;">repo that you&#39;ve checked out on the machine.</p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">connectbox-tools</p><p style="text-indent: 0pt;text-align: left;"/><p class="s24" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">Update the CHANGELOG.md file in the connectbox-pi repository to list any changes since the last build</p><p class="s24" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">Prepare a your target device with a base operating system image. On a NEO, use the most recent release from the <span style=" color: #0366D6;">https://github.com/ConnectBox/armbian-</span></p><p class="s23" style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">build <span style=" color: #24292E;">repository. For an RPi, try the most recent release of Raspbian lite, but know that ymmv because their image changes.</span></p><p class="s37" style="padding-left: 16pt;text-indent: 0pt;line-height: 14pt;text-align: left;">3. <span class="s24">Login to the virtual machine that you&#39;ve setup in the </span><i>Release Machine Setup</i></p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">connectbox-tools/</p><p style="text-indent: 0pt;text-align: left;"/><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">vagrant ssh</p><p style="text-indent: 0pt;text-align: left;"/><p class="s24" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">section. You can do that by running                         in the</p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">deployment</p><p style="text-indent: 0pt;text-align: left;"/><p class="s24" style="padding-left: 116pt;text-indent: 0pt;text-align: left;">directory to login to the virtual machine.</p><p class="s37" style="padding-left: 16pt;text-indent: 0pt;line-height: 14pt;text-align: left;">4. <span class="s24">Make sure that you can perform a passwordless login as root on the target</span></p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">deployment</p><p style="text-indent: 0pt;text-align: left;"/><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">setup-armbian-host.sh</p><p style="text-indent: 0pt;text-align: left;"/><p class="s24" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">device (the</p><p class="s24" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">in the</p><p class="s24" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">directory makes it</p><p class="s24" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">easy if you have keys already available, and automates the 4 steps below, assuming you&#39;re building a NEO image - it&#39;s diﬀerent for an RPi)</p><p class="s24" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">•</p><p class="s24" style="text-indent: 0pt;text-align: right;">•</p><p class="s24" style="text-indent: 0pt;text-align: right;">•</p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">vagrant/prepare_release.py</p><p style="text-indent: 0pt;text-align: left;"/><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">CONNECTBOX_GITHUB_TOKEN=&lt;whatever-it-is&gt; python3 /</p><p style="text-indent: 0pt;text-align: left;"/><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">—-ask-pass</p><p style="text-indent: 0pt;text-align: left;"/><p class="s24" style="text-indent: 0pt;text-align: right;">•</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s37" style="padding-left: 16pt;text-indent: 0pt;line-height: 14pt;text-align: left;">5. <span class="s24">Run</span></p><p class="s24" style="padding-left: 130pt;text-indent: 0pt;text-align: left;">(pwd: 1234)</p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">ssh root@&lt;neoip&gt;</p><p style="text-indent: 0pt;text-align: left;"/><p class="s24" style="padding-left: 16pt;text-indent: 0pt;text-align: left;">Set root password to <i>connectbox </i>per the prompts Ctrl^c and do not create any extra accounts</p><p class="s24" style="padding-left: 16pt;text-indent: 0pt;text-align: left;">Put your ssh public key on the device so you don’t need to run ansible with</p><p class="s24" style="padding-left: 228pt;text-indent: 0pt;text-align: left;">on the release machine and follow the</p><p class="s24" style="padding-left: 37pt;text-indent: 0pt;text-align: left;">instructions.</p><p class="s37" style="padding-left: 37pt;text-indent: -21pt;text-align: left;">6. <span class="s24">If the process fails before you remove the microSD from the target device, you can continue the process by running</span></p><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">you-used-when-it-failed&gt;</p><p style="text-indent: 0pt;text-align: left;"/><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">prepare_release.py --use-existing-tag --tag=&lt;whatever-tag-</p><p style="text-indent: 0pt;text-align: left;"/><p class="s36" style="padding-top: 1pt;text-indent: 0pt;line-height: 13pt;text-align: left;">CONNECTBOX_GITHUB_TOKEN=&lt;whatever-it-is&gt; python3 /vagrant/</p><p style="text-indent: 0pt;text-align: left;"/><p class="s37" style="padding-left: 41pt;text-indent: -25pt;text-align: left;">7. <span class="s24">Update the description of the github release to add release notes, consider whether this is a pre-release and mark it accordingly (historically, release have been marked as pre-release when they&#39;ve only had limited testing).</span></p><p class="s37" style="padding-left: 16pt;text-indent: 0pt;line-height: 14pt;text-align: left;">8. <span class="s24">Publish the release to take it out of draft stage.</span></p><p class="s37" style="padding-left: 16pt;text-indent: 0pt;line-height: 14pt;text-align: left;">9. <span class="s24">Broadcast availability on slack.</span></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part25.htm">&lt; Previous</a><span> | </span><a href="../Making%20A%20ConnectBox%20on%20RPi.html">Contents</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
