<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Section 6: Shrinking the uSD Image</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part20.htm">&lt; Previous</a><span> | </span><a href="../Making_A_ConnectBox.html">Contents</a><span> | </span><a href="part22.htm">Next &gt;</a></p><h2 style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Section 6: Shrinking the uSD Image</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The following are instructions for shrinking the image on a uSD card. The process is very similar for both Mac and RPi development machines. Where diﬀerences exist, we will preface the step number with &quot;M&quot; (Mac) or &quot;R&quot; (Rpi).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 106%;text-align: left;"><span class="s12" style=" background-color: #88FA4E;">Step 6.1:</span><span class="p"> After powering down the target machine and removing the microSD card, put the uSD card into a </span><span class="s17">microSD to USB </span><span class="p">adapter. (IMPORTANT: a microSD to SD card adaptor WILL NOT WORK. </span><span class="s17">You MUST use a USB type adaptor</span><span class="p">.) Plug the USB adaptor into the computer (ie, Mac or RPi build machine).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s12" style=" background-color: #88FA4E;">Step 6.2:</span><span class="p"> In the terminal window type:</span></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">~$ <span style=" color: #B51700;">lsblk</span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">If the image is for a NEO target, you should see entries for &quot;<span style=" color: #B51700;">sdb</span>&quot; and &quot;<span style=" color: #B51700;">sdb1</span>&quot;. If the image is for an RPi target you should see entries for &quot;<span style=" color: #B51700;">sdb</span>&quot;, &quot;<span style=" color: #B51700;">sdb1</span>&quot; and &quot;<span style=" color: #B51700;">sdb2</span>&quot;. This will indicate that the uSD has been seen by the system and can be accessed by the next command.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s12" style=" background-color: #88FA4E;">Step M6.3:</span><span class="p"> In the terminal window type:</span></p><p style="padding-left: 5pt;text-indent: 36pt;text-align: left;">~$ <span style=" color: #B51700;">sudo /vagrant/shrink-image.sh /dev/sdb /vagrant/&lt;nameYourImage&gt;.img </span>where &quot;<span style=" color: #B51700;">&lt;nameYourImage&gt;.img</span>&quot; is the name you want to use for the image about to be created.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s12" style=" background-color: #88FA4E;">Step R6.2:</span><span class="p"> In the terminal window type:</span></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">~$ <span style=" color: #B51700;">umount /dev/sda1</span></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">~$ <span style=" color: #B51700;">umount /dev/sda2.      </span>(only if you found an sda2</p><p style="padding-left: 185pt;text-indent: 0pt;text-align: left;">in response to the lsblk command)</p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">~$ <span style=" color: #B51700;">cd /home/pi/connectbox</span></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">~$ <span style=" color: #B51700;">sudo connectbox-tools/deployment/shrink-image.sh /dev/sda Images/</span></p><p class="s13" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;nameYourImage&gt;.img</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">where &quot;<span style=" color: #B51700;">&lt;nameYourImage&gt;.img</span>&quot; is the name you want to use for the image about to be created.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s12" style=" background-color: #88FA4E;">Step M6.3:</span><span class="p"> When this step completes (10-20 minutes) you will have an image of the uSD which will be available in your </span><span class="s13">/vagrant </span><span class="p">directory (from within the terminal window). (Note that this directory is the same as your </span><span class="s13">connectbox-tools-master/deployment </span><span class="p">directory of your Mac.)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s12" style=" background-color: #88FA4E;">Step R6.3:</span><span class="p"> When this step completes (10-20 minutes) you will have an image of the uSD which will be available in your </span><span class="s13">/home/pi/connectbox/Images/ </span><span class="p">directory.</span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span class="s12" style=" background-color: #88FA4E;">Step 6.4:</span><span class="p"> If you want to compress your .img file using the xz compression tool, you can now type:</span></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">~$ <span style=" color: #B51700;">xz -k &lt;path to your image file&gt;</span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">and after about an hour, you should have a compressed version of your image located in the same folder as your image file and having the same name as your <span style=" color: #B51700;">.img </span>file but ending in &quot;<span style=" color: #B51700;">.img.xz</span>&quot;.</p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part22.htm">APPENDIX - Edwin’s original document</a><a class="toc1" href="part23.htm">Once-oﬀ steps</a><a class="toc1" href="part24.htm">Release Machine Setup (automated)</a><a class="toc1" href="part25.htm">Release Machine Setup (manual)</a><a class="toc1" href="part26.htm">Per-build</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part20.htm">&lt; Previous</a><span> | </span><a href="../Making_A_ConnectBox.html">Contents</a><span> | </span><a href="part22.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
